#!/bin/bash
# Periodic version check for tmux status bar
# Writes to /tmp/envhaven-version-status

CURRENT="${ENVHAVEN_VERSION:-dev}"

if [[ "${ENVHAVEN_MANAGED:-}" == "true" ]] && [[ -n "${ENVHAVEN_API_URL:-}" ]]; then
  LATEST=$(curl -sf "$ENVHAVEN_API_URL/v1/version" 2>/dev/null | jq -r '.latest // empty')
  
  if [[ -n "$LATEST" ]] && [[ "$CURRENT" != "$LATEST" ]]; then
    echo "$CURRENT âš¡ $LATEST available" > /tmp/envhaven-version-status
  else
    echo "$CURRENT" > /tmp/envhaven-version-status
  fi
else
  echo "$CURRENT" > /tmp/envhaven-version-status
fi
